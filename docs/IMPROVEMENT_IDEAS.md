# Идеи по улучшению проекта

Ниже — направления, которые могут сделать проект лучше. Можно выбирать по приоритету и сложности.

---

## 1. Удобство результата (финал объявления)

- **Копировать в буфер / экспорт**  
  Кнопки «Скопировать описание», «Скачать текст объявления (.txt)», при желании — **экспорт в PDF** (шапка + параметры + описание + превью фото), чтобы сразу отправить или сохранить.

- **Превью объявления**  
  Блок «Как будет выглядеть объявление»: карточка в стиле Дрома/Авито (фото сверху, параметры, цена, описание), чтобы пользователь видел итог перед копированием.

- **Чек-лист перед публикацией**  
  Небольшой чек-лист: все обязательные поля заполнены, есть рекомендация по цене, фото по рекомендациям добавлены — и кнопка «Готово к публикации» или «Скопировать всё».

---

## 2. Работа с фото и повторный анализ

- **«Обновить анализ» после добавления/удаления фото**  
  Сейчас при добавлении/удалении фото в блоке рекомендаций данные объявления не пересчитываются. Кнопка **«Обновить анализ по текущим фото»** могла бы заново вызывать `/api/analyze` с новым набором файлов и подставлять обновлённые car_identity, состояние, цену, описание (с предупреждением «текущие правки в форме могут быть перезаписаны» или с выбором «дополнить только пустые поля»).

- **Сжатие изображений перед отправкой**  
  Опциональное сжатие/уменьшение размера на фронте перед загрузкой — меньше трафика и быстрее ответ агентов (особенно при многих фото).

- **Подсказки по рекомендациям**  
  В блоке рекомендаций рядом с «Не хватает фото: Одометр, VIN» — короткие подсказки: «Сфотографируйте приборную панель при включённом зажигании», «VIN обычно на стойке водителя или под лобовым».

---

## 3. Надёжность и стабильность

- **Повтор запроса при сбое**  
  Для вызовов LLM (анализ, цена, описание, рекомендации): retry с экспоненциальной задержкой при 5xx или таймауте, 1–2 повторные попытки.

- **Таймауты и фоновая обработка**  
  Длинный расчёт цены уже имеет таймаут на фронте; на бэкенде можно вынести тяжёлые запросы в фоновую задачу (Celery/Redis или просто asyncio) и возвращать ответ по готовности (polling или WebSocket), чтобы не держать HTTP-соединение минутами.

- **Логирование и мониторинг**  
  Логировать вызовы агентов (без персональных данных), время выполнения, ошибки. При желании — интеграция с Sentry (или аналог) для сбора ошибок в проде.

- **Health-check**  
  Эндпоинт `GET /api/health` (проверка БД/внешних сервисов при наличии) для мониторинга и деплоя.

---

## 4. Тестирование и качество кода

- **Тесты оркестратора**  
  Unit-тесты: мок ответов агентов → проверка, что оркестратор правильно собирает `AnalysisResponse`, маппит дефекты, выставляет status и confidence_warnings.

- **Тесты агентов (опционально)**  
  Интеграционные тесты с фиксированными промптами и моком API (или одним тестовым вызовом) для vision, classification, pricing, recommender — чтобы не ломать контракт при изменении промптов.

- **Валидация форм**  
  Явная валидация на фронте (и при необходимости на бэке): год в диапазоне, пробег ≥ 0, объём двигателя > 0, обязательные поля перед «Пересчитать цену» и т.д.

---

## 5. Производительность и UX долгих операций

- **Стриминг описания**  
  Генерация описания через streaming (SSE или chunked response): текст появляется по мере генерации, пользователь видит прогресс.

- **Кэш оценки цены**  
  Для одного и того же набора полей (car_identity + состояние + дефекты) не вызывать повторно LLM+CatBoost, а отдавать закэшированный результат (in-memory или Redis) с TTL, чтобы при частых переключениях полей не ждать каждый раз 1–2 минуты.

- **Прогресс анализа**  
  При первом анализе (vision + classification + pricing + description) показывать пошаговый прогресс: «Анализ фото…» → «Определение параметров…» → «Оценка цены…» → «Генерация описания…» (если бэкенд сможет отдавать этапы через SSE или отдельные эндпоинты).

---

## 6. Дополнительные функции продукта

- **Черновики**  
  Сохранение черновика в `localStorage` (или в бэкенде при появлении авторизации): восстановление после перезагрузки страницы или «Вернуть последний черновик».

- **Шаблоны описания**  
  Выбор стиля: «Краткое», «Подробное», «Для премиум-площадок» — разные промпты или постобработка текста под длину/тон.

- **VIN (опционально)**  
  Поле VIN и расшифровка (марка, модель, год) через бесплатный API или локальная логика — подстановка в форму и проверка против того, что распознал ИИ по фото.

- **Сравнение с рынком**  
  При наличии доступа к API площадок или своей БД объявлений — блок «Похожие объявления: цены от X до Y» для сравнения с рекомендованной ценой.

---

## 7. Деплой и среда

- **Docker**  
  `Dockerfile` для бэкенда и фронта (или multi-stage для фронта), `docker-compose.yml` — один запуск (`docker-compose up`) с переменными для `OPENAI_API_KEY` и портов.

- **Конфигурация по средам**  
  Раздельные настройки для dev/prod (URL API, лимиты, логи), через `.env` и `VITE_*` на фронте.

- **Rate limiting**  
  Ограничение числа запросов к `/api/analyze` и `/api/recalculate-price` с одного IP/пользователя, чтобы защититься от злоупотреблений и лимитов OpenAI.

---

## 8. Доступность и интерфейс

- **Адаптивность**  
  Проверить и доработать вёрстку на мобильных: галерея, форма, длинные списки — чтобы удобно было заполнять объявление с телефона.

- **Тёмная тема**  
  Переключатель темы (или следование системной) на основе уже используемых CSS-переменных.

- **Ясные сообщения об ошибках**  
  При ошибке сети или 5xx показывать короткую инструкцию («Проверьте интернет», «Попробуйте позже») и кнопку «Повторить».

---

## Приоритизация (пример)

| Приоритет | Что сделать | Зачем |
|-----------|--------------|--------|
| Высокий   | Экспорт/копирование объявления, превью | Пользователь сразу получает готовый результат. |
| Высокий   | «Обновить анализ» по новым фото | Логичное продолжение блока рекомендаций. |
| Средний   | Retry при сбоях, health-check | Стабильность и удобство деплоя. |
| Средний   | Черновик в localStorage | Не потерять данные при перезагрузке. |
| Средний   | Стриминг описания или пошаговый прогресс | Ощущение скорости при долгих операциях. |
| Низкий    | Docker, rate limiting | Готовность к «боевому» запуску. |
| Низкий    | Тесты оркестратора | Безопасно менять маппинг и контракты. |

Документ можно дополнять новыми идеями и вычёркивать реализованное.
